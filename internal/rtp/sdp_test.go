package rtp

import (
	"testing"

	"github.com/google/uuid"
	"github.com/pion/webrtc/v3"
	"github.com/stretchr/testify/assert"
)

const sdpOfferString = "v=0\no=- 4259503283085041920 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS 91275403-889a-4cc3-971f-109e0d5e9bd6\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\ni=1 1 Guest-Audio\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-ufrag:vb2/\na=ice-pwd:lsvp3wbps99khhFRo2dGqpVz\na=ice-options:trickle\na=fingerprint:sha-256 6A:7F:97:11:89:37:86:83:9B:FA:6D:EA:1B:5C:98:A8:A5:EF:A3:F3:95:27:32:CF:32:3C:27:4A:07:9D:FB:86\na=setup:actpass\na=mid:0\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\na=sendrecv\na=msid:91275403-889a-4cc3-971f-109e0d5e9bd6 359bc90f-bc4c-47a7-b283-30e88abc2374\na=rtcp-mux\na=rtpmap:111 opus/48000/2\na=rtcp-fb:111 transport-cc\na=fmtp:111 minptime=10;useinbandfec=1\na=rtpmap:63 red/48000/2\na=fmtp:63 111/111\na=rtpmap:9 G722/8000\na=rtpmap:0 PCMU/8000\na=rtpmap:8 PCMA/8000\na=rtpmap:13 CN/8000\na=rtpmap:110 telephone-event/48000\na=rtpmap:126 telephone-event/8000\na=ssrc:131678439 cname:aDkWokd0eDB73FT1\na=ssrc:131678439 msid:91275403-889a-4cc3-971f-109e0d5e9bd6 359bc90f-bc4c-47a7-b283-30e88abc2374\nm=video 9 UDP/TLS/RTP/SAVPF 96 97 102 103 104 105 106 107 108 109 127 125 39 40 45 46 98 99 100 101 112 113 116 117 118\ni=1 2 Guest-Video\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-ufrag:vb2/\na=ice-pwd:lsvp3wbps99khhFRo2dGqpVz\na=ice-options:trickle\na=fingerprint:sha-256 6A:7F:97:11:89:37:86:83:9B:FA:6D:EA:1B:5C:98:A8:A5:EF:A3:F3:95:27:32:CF:32:3C:27:4A:07:9D:FB:86\na=setup:actpass\na=mid:1\na=extmap:14 urn:ietf:params:rtp-hdrext:toffset\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:13 urn:3gpp:video-orientation\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\na=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/video-content-type\na=extmap:7 http://www.webrtc.org/experiments/rtp-hdrext/video-timing\na=extmap:8 http://www.webrtc.org/experiments/rtp-hdrext/color-space\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\na=extmap:10 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\na=extmap:11 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\na=sendrecv\na=msid:91275403-889a-4cc3-971f-109e0d5e9bd6 2e86a7ac-b7e9-470f-9c53-6160e468e658\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:96 VP8/90000\na=rtcp-fb:96 goog-remb\na=rtcp-fb:96 transport-cc\na=rtcp-fb:96 ccm fir\na=rtcp-fb:96 nack\na=rtcp-fb:96 nack pli\na=rtpmap:97 rtx/90000\na=fmtp:97 apt=96\na=rtpmap:102 H264/90000\na=rtcp-fb:102 goog-remb\na=rtcp-fb:102 transport-cc\na=rtcp-fb:102 ccm fir\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\na=rtpmap:103 rtx/90000\na=fmtp:103 apt=102\na=rtpmap:104 H264/90000\na=rtcp-fb:104 goog-remb\na=rtcp-fb:104 transport-cc\na=rtcp-fb:104 ccm fir\na=rtcp-fb:104 nack\na=rtcp-fb:104 nack pli\na=fmtp:104 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\na=rtpmap:105 rtx/90000\na=fmtp:105 apt=104\na=rtpmap:106 H264/90000\na=rtcp-fb:106 goog-remb\na=rtcp-fb:106 transport-cc\na=rtcp-fb:106 ccm fir\na=rtcp-fb:106 nack\na=rtcp-fb:106 nack pli\na=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\na=rtpmap:107 rtx/90000\na=fmtp:107 apt=106\na=rtpmap:108 H264/90000\na=rtcp-fb:108 goog-remb\na=rtcp-fb:108 transport-cc\na=rtcp-fb:108 ccm fir\na=rtcp-fb:108 nack\na=rtcp-fb:108 nack pli\na=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\na=rtpmap:109 rtx/90000\na=fmtp:109 apt=108\na=rtpmap:127 H264/90000\na=rtcp-fb:127 goog-remb\na=rtcp-fb:127 transport-cc\na=rtcp-fb:127 ccm fir\na=rtcp-fb:127 nack\na=rtcp-fb:127 nack pli\na=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\na=rtpmap:125 rtx/90000\na=fmtp:125 apt=127\na=rtpmap:39 H264/90000\na=rtcp-fb:39 goog-remb\na=rtcp-fb:39 transport-cc\na=rtcp-fb:39 ccm fir\na=rtcp-fb:39 nack\na=rtcp-fb:39 nack pli\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\na=rtpmap:40 rtx/90000\na=fmtp:40 apt=39\na=rtpmap:45 AV1/90000\na=rtcp-fb:45 goog-remb\na=rtcp-fb:45 transport-cc\na=rtcp-fb:45 ccm fir\na=rtcp-fb:45 nack\na=rtcp-fb:45 nack pli\na=rtpmap:46 rtx/90000\na=fmtp:46 apt=45\na=rtpmap:98 VP9/90000\na=rtcp-fb:98 goog-remb\na=rtcp-fb:98 transport-cc\na=rtcp-fb:98 ccm fir\na=rtcp-fb:98 nack\na=rtcp-fb:98 nack pli\na=fmtp:98 profile-id=0\na=rtpmap:99 rtx/90000\na=fmtp:99 apt=98\na=rtpmap:100 VP9/90000\na=rtcp-fb:100 goog-remb\na=rtcp-fb:100 transport-cc\na=rtcp-fb:100 ccm fir\na=rtcp-fb:100 nack\na=rtcp-fb:100 nack pli\na=fmtp:100 profile-id=2\na=rtpmap:101 rtx/90000\na=fmtp:101 apt=100\na=rtpmap:112 H264/90000\na=rtcp-fb:112 goog-remb\na=rtcp-fb:112 transport-cc\na=rtcp-fb:112 ccm fir\na=rtcp-fb:112 nack\na=rtcp-fb:112 nack pli\na=fmtp:112 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\na=rtpmap:113 rtx/90000\na=fmtp:113 apt=112\na=rtpmap:116 red/90000\na=rtpmap:117 rtx/90000\na=fmtp:117 apt=116\na=rtpmap:118 ulpfec/90000\na=ssrc-group:FID 1944013071 4279620428\na=ssrc:1944013071 cname:aDkWokd0eDB73FT1\na=ssrc:1944013071 msid:91275403-889a-4cc3-971f-109e0d5e9bd6 2e86a7ac-b7e9-470f-9c53-6160e468e658\na=ssrc:4279620428 cname:aDkWokd0eDB73FT1\na=ssrc:4279620428 msid:91275403-889a-4cc3-971f-109e0d5e9bd6 2e86a7ac-b7e9-470f-9c53-6160e468e658\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=ice-ufrag:vb2/\na=ice-pwd:lsvp3wbps99khhFRo2dGqpVz\na=ice-options:trickle\na=fingerprint:sha-256 6A:7F:97:11:89:37:86:83:9B:FA:6D:EA:1B:5C:98:A8:A5:EF:A3:F3:95:27:32:CF:32:3C:27:4A:07:9D:FB:86\na=setup:actpass\na=mid:2\na=sctp-port:5000\na=max-message-size:262144\n"
const sdpFirefoxOfferString = "v=0\no=mozilla...THIS_IS_SDPARTA-99.0 2250029483657317731 0 IN IP4 0.0.0.0\ns=-\nt=0 0\na=fingerprint:sha-256 44:CC:AD:DD:10:6F:FF:4A:B8:A6:BA:DE:F7:F9:18:67:CC:6F:A0:E9:FA:10:86:3E:D7:D6:57:BE:73:C6:D0:3C\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *\nm=audio 9 UDP/TLS/RTP/SAVPF 109 9 0 8 101\ni=1 1 Guest-Audio\nc=IN IP4 0.0.0.0\na=sendrecv\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\na=extmap:2/recvonly urn:ietf:params:rtp-hdrext:csrc-audio-level\na=extmap:3 urn:ietf:params:rtp-hdrext:sdes:mid\na=fmtp:109 maxplaybackrate=48000;stereo=1;useinbandfec=1\na=fmtp:101 0-15\na=ice-pwd:de66ad6c35a810083bf366b1f221fd83\na=ice-ufrag:98142d40\na=mid:0\na=msid:{2f97a64f-8e54-46c9-8956-e27b202d76cf} {fa595b2c-ba3a-4cd9-93b8-91c20b8af758}\na=rtcp-mux\na=rtpmap:109 opus/48000/2\na=rtpmap:9 G722/8000/1\na=rtpmap:0 PCMU/8000\na=rtpmap:8 PCMA/8000\na=rtpmap:101 telephone-event/8000/1\na=setup:actpass\na=ssrc:2216140254 cname:{cdf59219-b766-456e-b673-afb16ade3d91}\nm=video 9 UDP/TLS/RTP/SAVPF 120 124 121 125 126 127 97 98\ni=1 2 Guest-Video\nc=IN IP4 0.0.0.0\na=sendrecv\na=extmap:3 urn:ietf:params:rtp-hdrext:sdes:mid\na=extmap:4 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:5 urn:ietf:params:rtp-hdrext:toffset\na=extmap:6/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\na=extmap:7 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=fmtp:126 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1\na=fmtp:97 profile-level-id=42e01f;level-asymmetry-allowed=1\na=fmtp:120 max-fs=12288;max-fr=60\na=fmtp:124 apt=120\na=fmtp:121 max-fs=12288;max-fr=60\na=fmtp:125 apt=121\na=fmtp:127 apt=126\na=fmtp:98 apt=97\na=ice-pwd:de66ad6c35a810083bf366b1f221fd83\na=ice-ufrag:98142d40\na=mid:1\na=msid:{2f97a64f-8e54-46c9-8956-e27b202d76cf} {397dc6f7-76cc-4044-9a12-15cb433b99fc}\na=rtcp-fb:120 nack\na=rtcp-fb:120 nack pli\na=rtcp-fb:120 ccm fir\na=rtcp-fb:120 goog-remb\na=rtcp-fb:120 transport-cc\na=rtcp-fb:121 nack\na=rtcp-fb:121 nack pli\na=rtcp-fb:121 ccm fir\na=rtcp-fb:121 goog-remb\na=rtcp-fb:121 transport-cc\na=rtcp-fb:126 nack\na=rtcp-fb:126 nack pli\na=rtcp-fb:126 ccm fir\na=rtcp-fb:126 goog-remb\na=rtcp-fb:126 transport-cc\na=rtcp-fb:97 nack\na=rtcp-fb:97 nack pli\na=rtcp-fb:97 ccm fir\na=rtcp-fb:97 goog-remb\na=rtcp-fb:97 transport-cc\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:120 VP8/90000\na=rtpmap:124 rtx/90000\na=rtpmap:121 VP9/90000\na=rtpmap:125 rtx/90000\na=rtpmap:126 H264/90000\na=rtpmap:127 rtx/90000\na=rtpmap:97 H264/90000\na=rtpmap:98 rtx/90000\na=setup:actpass\na=ssrc:651108280 cname:{cdf59219-b766-456e-b673-afb16ade3d91}\na=ssrc:687153943 cname:{cdf59219-b766-456e-b673-afb16ade3d91}\na=ssrc-group:FID 651108280 687153943\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=sendrecv\na=ice-pwd:de66ad6c35a810083bf366b1f221fd83\na=ice-ufrag:98142d40\na=mid:2\na=setup:actpass\na=sctp-port:5000\na=max-message-size:1073741823\n"
const sdpOfferWithLiveStream = "v=0\no=- 2276583948299990822 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=extmap-allow-mixed\na=msid-semantic: WMS 03b32495-2823-49c5-8e80-981a017e5209\na=group:BUNDLE 0 1 2 3 4\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\ni=1 2 Guest-Audio\nc=IN IP4 0.0.0.0\na=rtpmap:111 opus/48000/2\na=rtpmap:63 red/48000/2\na=rtpmap:9 G722/8000\na=rtpmap:0 PCMU/8000\na=rtpmap:8 PCMA/8000\na=rtpmap:13 CN/8000\na=rtpmap:110 telephone-event/48000\na=rtpmap:126 telephone-event/8000\na=fmtp:111 minptime=10;useinbandfec=1\na=fmtp:63 111/111\na=rtcp:9 IN IP4 0.0.0.0\na=rtcp-fb:111 transport-cc\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\na=setup:actpass\na=mid:0\na=msid:03b32495-2823-49c5-8e80-981a017e5209 57e34f3b-e41d-4dd1-94ef-a5db7d13ca53\na=sendrecv\na=ice-ufrag:MjVA\na=ice-pwd:PYA/s3AoA8hXWhCYAnqs1CFk\na=fingerprint:sha-256 6A:20:1D:34:F4:C5:F1:F3:F7:BF:02:95:B8:31:70:46:93:CD:D8:FB:12:D8:DD:62:58:B2:75:3A:A0:FE:65:7F\na=ice-options:trickle\na=ssrc:2270103821 cname:rg5s0YRoVwWl4CNk\na=ssrc:2270103821 msid:03b32495-2823-49c5-8e80-981a017e5209 57e34f3b-e41d-4dd1-94ef-a5db7d13ca53\na=rtcp-mux\nm=video 9 UDP/TLS/RTP/SAVPF 96 97 102 103 104 105 106 107 108 109 127 125 39 40 45 46 98 99 100 101 112 113 116 117 118\ni=1 2 Guest-Video\nc=IN IP4 0.0.0.0\na=rtpmap:96 VP8/90000\na=rtpmap:97 rtx/90000\na=rtpmap:102 H264/90000\na=rtpmap:103 rtx/90000\na=rtpmap:104 H264/90000\na=rtpmap:105 rtx/90000\na=rtpmap:106 H264/90000\na=rtpmap:107 rtx/90000\na=rtpmap:108 H264/90000\na=rtpmap:109 rtx/90000\na=rtpmap:127 H264/90000\na=rtpmap:125 rtx/90000\na=rtpmap:39 H264/90000\na=rtpmap:40 rtx/90000\na=rtpmap:45 AV1/90000\na=rtpmap:46 rtx/90000\na=rtpmap:98 VP9/90000\na=rtpmap:99 rtx/90000\na=rtpmap:100 VP9/90000\na=rtpmap:101 rtx/90000\na=rtpmap:112 H264/90000\na=rtpmap:113 rtx/90000\na=rtpmap:116 red/90000\na=rtpmap:117 rtx/90000\na=rtpmap:118 ulpfec/90000\na=fmtp:97 apt=96\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\na=fmtp:103 apt=102\na=fmtp:104 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\na=fmtp:105 apt=104\na=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\na=fmtp:107 apt=106\na=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\na=fmtp:109 apt=108\na=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\na=fmtp:125 apt=127\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\na=fmtp:40 apt=39\na=fmtp:46 apt=45\na=fmtp:98 profile-id=0\na=fmtp:99 apt=98\na=fmtp:100 profile-id=2\na=fmtp:101 apt=100\na=fmtp:112 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\na=fmtp:113 apt=112\na=fmtp:117 apt=116\na=rtcp:9 IN IP4 0.0.0.0\na=rtcp-fb:96 goog-remb\na=rtcp-fb:96 transport-cc\na=rtcp-fb:96 ccm fir\na=rtcp-fb:96 nack\na=rtcp-fb:96 nack pli\na=rtcp-fb:102 goog-remb\na=rtcp-fb:102 transport-cc\na=rtcp-fb:102 ccm fir\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=rtcp-fb:104 goog-remb\na=rtcp-fb:104 transport-cc\na=rtcp-fb:104 ccm fir\na=rtcp-fb:104 nack\na=rtcp-fb:104 nack pli\na=rtcp-fb:106 goog-remb\na=rtcp-fb:106 transport-cc\na=rtcp-fb:106 ccm fir\na=rtcp-fb:106 nack\na=rtcp-fb:106 nack pli\na=rtcp-fb:108 goog-remb\na=rtcp-fb:108 transport-cc\na=rtcp-fb:108 ccm fir\na=rtcp-fb:108 nack\na=rtcp-fb:108 nack pli\na=rtcp-fb:127 goog-remb\na=rtcp-fb:127 transport-cc\na=rtcp-fb:127 ccm fir\na=rtcp-fb:127 nack\na=rtcp-fb:127 nack pli\na=rtcp-fb:39 goog-remb\na=rtcp-fb:39 transport-cc\na=rtcp-fb:39 ccm fir\na=rtcp-fb:39 nack\na=rtcp-fb:39 nack pli\na=rtcp-fb:45 goog-remb\na=rtcp-fb:45 transport-cc\na=rtcp-fb:45 ccm fir\na=rtcp-fb:45 nack\na=rtcp-fb:45 nack pli\na=rtcp-fb:98 goog-remb\na=rtcp-fb:98 transport-cc\na=rtcp-fb:98 ccm fir\na=rtcp-fb:98 nack\na=rtcp-fb:98 nack pli\na=rtcp-fb:100 goog-remb\na=rtcp-fb:100 transport-cc\na=rtcp-fb:100 ccm fir\na=rtcp-fb:100 nack\na=rtcp-fb:100 nack pli\na=rtcp-fb:112 goog-remb\na=rtcp-fb:112 transport-cc\na=rtcp-fb:112 ccm fir\na=rtcp-fb:112 nack\na=rtcp-fb:112 nack pli\na=extmap:14 urn:ietf:params:rtp-hdrext:toffset\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:13 urn:3gpp:video-orientation\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\na=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/video-content-type\na=extmap:7 http://www.webrtc.org/experiments/rtp-hdrext/video-timing\na=extmap:8 http://www.webrtc.org/experiments/rtp-hdrext/color-space\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\na=extmap:10 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\na=extmap:11 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\na=setup:actpass\na=mid:1\na=msid:03b32495-2823-49c5-8e80-981a017e5209 5dacbd5d-f234-4496-923a-c5c188ee9424\na=sendrecv\na=ice-ufrag:MjVA\na=ice-pwd:PYA/s3AoA8hXWhCYAnqs1CFk\na=fingerprint:sha-256 6A:20:1D:34:F4:C5:F1:F3:F7:BF:02:95:B8:31:70:46:93:CD:D8:FB:12:D8:DD:62:58:B2:75:3A:A0:FE:65:7F\na=ice-options:trickle\na=ssrc:125809081 cname:rg5s0YRoVwWl4CNk\na=ssrc:125809081 msid:03b32495-2823-49c5-8e80-981a017e5209 5dacbd5d-f234-4496-923a-c5c188ee9424\na=ssrc:1197785900 cname:rg5s0YRoVwWl4CNk\na=ssrc:1197785900 msid:03b32495-2823-49c5-8e80-981a017e5209 5dacbd5d-f234-4496-923a-c5c188ee9424\na=ssrc-group:FID 125809081 1197785900\na=rtcp-mux\na=rtcp-rsize\nm=audio 9 UDP/TLS/RTP/SAVPF 111 63 9 0 8 13 110 126\ni=2 1 Main-Audio\nc=IN IP4 0.0.0.0\na=rtpmap:111 opus/48000/2\na=rtpmap:63 red/48000/2\na=rtpmap:9 G722/8000\na=rtpmap:0 PCMU/8000\na=rtpmap:8 PCMA/8000\na=rtpmap:13 CN/8000\na=rtpmap:110 telephone-event/48000\na=rtpmap:126 telephone-event/8000\na=fmtp:111 minptime=10;useinbandfec=1\na=fmtp:63 111/111\na=rtcp:9 IN IP4 0.0.0.0\na=rtcp-fb:111 transport-cc\na=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\na=setup:actpass\na=mid:2\na=msid:45def0ae-d3dd-4a2c-80c8-4aa37d6e2c2d a9345edd-5648-4d78-81be-02e0114adbcd\na=sendrecv\na=ice-ufrag:MjVA\na=ice-pwd:PYA/s3AoA8hXWhCYAnqs1CFk\na=fingerprint:sha-256 6A:20:1D:34:F4:C5:F1:F3:F7:BF:02:95:B8:31:70:46:93:CD:D8:FB:12:D8:DD:62:58:B2:75:3A:A0:FE:65:7F\na=ice-options:trickle\na=ssrc:3450704251 cname:rg5s0YRoVwWl4CNk\na=ssrc:3450704251 msid:45def0ae-d3dd-4a2c-80c8-4aa37d6e2c2d a9345edd-5648-4d78-81be-02e0114adbcd\na=rtcp-mux\nm=video 9 UDP/TLS/RTP/SAVPF 96 97 102 103 104 105 106 107 108 109 127 125 39 40 45 46 98 99 100 101 112 113 116 117 118\ni=2 1 Main-Video\nc=IN IP4 0.0.0.0\na=rtpmap:96 VP8/90000\na=rtpmap:97 rtx/90000\na=rtpmap:102 H264/90000\na=rtpmap:103 rtx/90000\na=rtpmap:104 H264/90000\na=rtpmap:105 rtx/90000\na=rtpmap:106 H264/90000\na=rtpmap:107 rtx/90000\na=rtpmap:108 H264/90000\na=rtpmap:109 rtx/90000\na=rtpmap:127 H264/90000\na=rtpmap:125 rtx/90000\na=rtpmap:39 H264/90000\na=rtpmap:40 rtx/90000\na=rtpmap:45 AV1/90000\na=rtpmap:46 rtx/90000\na=rtpmap:98 VP9/90000\na=rtpmap:99 rtx/90000\na=rtpmap:100 VP9/90000\na=rtpmap:101 rtx/90000\na=rtpmap:112 H264/90000\na=rtpmap:113 rtx/90000\na=rtpmap:116 red/90000\na=rtpmap:117 rtx/90000\na=rtpmap:118 ulpfec/90000\na=fmtp:97 apt=96\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\na=fmtp:103 apt=102\na=fmtp:104 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\na=fmtp:105 apt=104\na=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\na=fmtp:107 apt=106\na=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\na=fmtp:109 apt=108\na=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\na=fmtp:125 apt=127\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\na=fmtp:40 apt=39\na=fmtp:46 apt=45\na=fmtp:98 profile-id=0\na=fmtp:99 apt=98\na=fmtp:100 profile-id=2\na=fmtp:101 apt=100\na=fmtp:112 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\na=fmtp:113 apt=112\na=fmtp:117 apt=116\na=rtcp:9 IN IP4 0.0.0.0\na=rtcp-fb:96 goog-remb\na=rtcp-fb:96 transport-cc\na=rtcp-fb:96 ccm fir\na=rtcp-fb:96 nack\na=rtcp-fb:96 nack pli\na=rtcp-fb:102 goog-remb\na=rtcp-fb:102 transport-cc\na=rtcp-fb:102 ccm fir\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=rtcp-fb:104 goog-remb\na=rtcp-fb:104 transport-cc\na=rtcp-fb:104 ccm fir\na=rtcp-fb:104 nack\na=rtcp-fb:104 nack pli\na=rtcp-fb:106 goog-remb\na=rtcp-fb:106 transport-cc\na=rtcp-fb:106 ccm fir\na=rtcp-fb:106 nack\na=rtcp-fb:106 nack pli\na=rtcp-fb:108 goog-remb\na=rtcp-fb:108 transport-cc\na=rtcp-fb:108 ccm fir\na=rtcp-fb:108 nack\na=rtcp-fb:108 nack pli\na=rtcp-fb:127 goog-remb\na=rtcp-fb:127 transport-cc\na=rtcp-fb:127 ccm fir\na=rtcp-fb:127 nack\na=rtcp-fb:127 nack pli\na=rtcp-fb:39 goog-remb\na=rtcp-fb:39 transport-cc\na=rtcp-fb:39 ccm fir\na=rtcp-fb:39 nack\na=rtcp-fb:39 nack pli\na=rtcp-fb:45 goog-remb\na=rtcp-fb:45 transport-cc\na=rtcp-fb:45 ccm fir\na=rtcp-fb:45 nack\na=rtcp-fb:45 nack pli\na=rtcp-fb:98 goog-remb\na=rtcp-fb:98 transport-cc\na=rtcp-fb:98 ccm fir\na=rtcp-fb:98 nack\na=rtcp-fb:98 nack pli\na=rtcp-fb:100 goog-remb\na=rtcp-fb:100 transport-cc\na=rtcp-fb:100 ccm fir\na=rtcp-fb:100 nack\na=rtcp-fb:100 nack pli\na=rtcp-fb:112 goog-remb\na=rtcp-fb:112 transport-cc\na=rtcp-fb:112 ccm fir\na=rtcp-fb:112 nack\na=rtcp-fb:112 nack pli\na=extmap:14 urn:ietf:params:rtp-hdrext:toffset\na=extmap:2 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time\na=extmap:13 urn:3gpp:video-orientation\na=extmap:3 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=extmap:5 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay\na=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/video-content-type\na=extmap:7 http://www.webrtc.org/experiments/rtp-hdrext/video-timing\na=extmap:8 http://www.webrtc.org/experiments/rtp-hdrext/color-space\na=extmap:4 urn:ietf:params:rtp-hdrext:sdes:mid\na=extmap:10 urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id\na=extmap:11 urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id\na=setup:actpass\na=mid:3\na=msid:45def0ae-d3dd-4a2c-80c8-4aa37d6e2c2d a0a03556-3aff-4684-b3ab-59c7bf4cb4bc\na=sendrecv\na=ice-ufrag:MjVA\na=ice-pwd:PYA/s3AoA8hXWhCYAnqs1CFk\na=fingerprint:sha-256 6A:20:1D:34:F4:C5:F1:F3:F7:BF:02:95:B8:31:70:46:93:CD:D8:FB:12:D8:DD:62:58:B2:75:3A:A0:FE:65:7F\na=ice-options:trickle\na=ssrc:804359473 cname:rg5s0YRoVwWl4CNk\na=ssrc:804359473 msid:45def0ae-d3dd-4a2c-80c8-4aa37d6e2c2d a0a03556-3aff-4684-b3ab-59c7bf4cb4bc\na=ssrc:2662083659 cname:rg5s0YRoVwWl4CNk\na=ssrc:2662083659 msid:45def0ae-d3dd-4a2c-80c8-4aa37d6e2c2d a0a03556-3aff-4684-b3ab-59c7bf4cb4bc\na=ssrc-group:FID 804359473 2662083659\na=rtcp-mux\na=rtcp-rsize\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:4\na=ice-ufrag:MjVA\na=ice-pwd:PYA/s3AoA8hXWhCYAnqs1CFk\na=fingerprint:sha-256 6A:20:1D:34:F4:C5:F1:F3:F7:BF:02:95:B8:31:70:46:93:CD:D8:FB:12:D8:DD:62:58:B2:75:3A:A0:FE:65:7F\na=ice-options:trickle\na=sctp-port:5000\na=max-message-size:262144\n"
const pionSdpOfferWithoutLiveStream = "v=0\no=- 3300033388955348848 1700297905 IN IP4 0.0.0.0\ns=-\nt=0 0\na=fingerprint:sha-256 88:BF:30:C5:4A:48:D2:2A:9E:3A:74:E1:7E:2A:3C:F1:6E:82:64:EE:9D:D9:56:81:C7:E8:F5:21:FE:AB:06:FD\na=extmap-allow-mixed\na=group:BUNDLE 0 1 2\nm=video 9 UDP/TLS/RTP/SAVPF 96 97 102 103 104 105 106 107 108 109 127 125 39 40 45 46 98 99 100 101 112 113\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:0\na=ice-ufrag:TdWlIfFKsezBQFZi\na=ice-pwd:BSCDgvfLwdRNSTktphhNdZNrMfjdsTbl\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:96 VP8/90000\na=rtcp-fb:96 goog-remb \na=rtcp-fb:96 ccm fir\na=rtcp-fb:96 nack \na=rtcp-fb:96 nack pli\na=rtcp-fb:96 nack \na=rtcp-fb:96 nack pli\na=rtcp-fb:96 transport-cc \na=rtpmap:97 rtx/90000\na=fmtp:97 apt=96\na=rtcp-fb:97 nack \na=rtcp-fb:97 nack pli\na=rtcp-fb:97 transport-cc \na=rtpmap:102 H264/90000\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\na=rtcp-fb:102 goog-remb \na=rtcp-fb:102 ccm fir\na=rtcp-fb:102 nack \na=rtcp-fb:102 nack pli\na=rtcp-fb:102 nack \na=rtcp-fb:102 nack pli\na=rtcp-fb:102 transport-cc \na=rtpmap:103 rtx/90000\na=fmtp:103 apt=102\na=rtcp-fb:103 nack \na=rtcp-fb:103 nack pli\na=rtcp-fb:103 transport-cc \na=rtpmap:104 H264/90000\na=fmtp:104 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\na=rtcp-fb:104 goog-remb \na=rtcp-fb:104 ccm fir\na=rtcp-fb:104 nack \na=rtcp-fb:104 nack pli\na=rtcp-fb:104 nack \na=rtcp-fb:104 nack pli\na=rtcp-fb:104 transport-cc \na=rtpmap:105 rtx/90000\na=fmtp:105 apt=104\na=rtcp-fb:105 nack \na=rtcp-fb:105 nack pli\na=rtcp-fb:105 transport-cc \na=rtpmap:106 H264/90000\na=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\na=rtcp-fb:106 goog-remb \na=rtcp-fb:106 ccm fir\na=rtcp-fb:106 nack \na=rtcp-fb:106 nack pli\na=rtcp-fb:106 nack \na=rtcp-fb:106 nack pli\na=rtcp-fb:106 transport-cc \na=rtpmap:107 rtx/90000\na=fmtp:107 apt=106\na=rtcp-fb:107 nack \na=rtcp-fb:107 nack pli\na=rtcp-fb:107 transport-cc \na=rtpmap:108 H264/90000\na=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\na=rtcp-fb:108 goog-remb \na=rtcp-fb:108 ccm fir\na=rtcp-fb:108 nack \na=rtcp-fb:108 nack pli\na=rtcp-fb:108 nack \na=rtcp-fb:108 nack pli\na=rtcp-fb:108 transport-cc \na=rtpmap:109 rtx/90000\na=fmtp:109 apt=108\na=rtcp-fb:109 nack \na=rtcp-fb:109 nack pli\na=rtcp-fb:109 transport-cc \na=rtpmap:127 H264/90000\na=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\na=rtcp-fb:127 goog-remb \na=rtcp-fb:127 ccm fir\na=rtcp-fb:127 nack \na=rtcp-fb:127 nack pli\na=rtcp-fb:127 nack \na=rtcp-fb:127 nack pli\na=rtcp-fb:127 transport-cc \na=rtpmap:125 rtx/90000\na=fmtp:125 apt=127\na=rtcp-fb:125 nack \na=rtcp-fb:125 nack pli\na=rtcp-fb:125 transport-cc \na=rtpmap:39 H264/90000\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\na=rtcp-fb:39 goog-remb \na=rtcp-fb:39 ccm fir\na=rtcp-fb:39 nack \na=rtcp-fb:39 nack pli\na=rtcp-fb:39 nack \na=rtcp-fb:39 nack pli\na=rtcp-fb:39 transport-cc \na=rtpmap:40 rtx/90000\na=fmtp:40 apt=39\na=rtcp-fb:40 nack \na=rtcp-fb:40 nack pli\na=rtcp-fb:40 transport-cc \na=rtpmap:45 AV1/90000\na=rtcp-fb:45 goog-remb \na=rtcp-fb:45 ccm fir\na=rtcp-fb:45 nack \na=rtcp-fb:45 nack pli\na=rtcp-fb:45 nack \na=rtcp-fb:45 nack pli\na=rtcp-fb:45 transport-cc \na=rtpmap:46 rtx/90000\na=fmtp:46 apt=45\na=rtcp-fb:46 nack \na=rtcp-fb:46 nack pli\na=rtcp-fb:46 transport-cc \na=rtpmap:98 VP9/90000\na=fmtp:98 profile-id=0\na=rtcp-fb:98 goog-remb \na=rtcp-fb:98 ccm fir\na=rtcp-fb:98 nack \na=rtcp-fb:98 nack pli\na=rtcp-fb:98 nack \na=rtcp-fb:98 nack pli\na=rtcp-fb:98 transport-cc \na=rtpmap:99 rtx/90000\na=fmtp:99 apt=98\na=rtcp-fb:99 nack \na=rtcp-fb:99 nack pli\na=rtcp-fb:99 transport-cc \na=rtpmap:100 VP9/90000\na=fmtp:100 profile-id=2\na=rtcp-fb:100 goog-remb \na=rtcp-fb:100 ccm fir\na=rtcp-fb:100 nack \na=rtcp-fb:100 nack pli\na=rtcp-fb:100 nack \na=rtcp-fb:100 nack pli\na=rtcp-fb:100 transport-cc \na=rtpmap:101 rtx/90000\na=fmtp:101 apt=100\na=rtcp-fb:101 nack \na=rtcp-fb:101 nack pli\na=rtcp-fb:101 transport-cc \na=rtpmap:112 H264/90000\na=fmtp:112 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\na=rtcp-fb:112 goog-remb \na=rtcp-fb:112 ccm fir\na=rtcp-fb:112 nack \na=rtcp-fb:112 nack pli\na=rtcp-fb:112 nack \na=rtcp-fb:112 nack pli\na=rtcp-fb:112 transport-cc \na=rtpmap:113 rtx/90000\na=fmtp:113 apt=112\na=rtcp-fb:113 nack \na=rtcp-fb:113 nack pli\na=rtcp-fb:113 transport-cc \na=extmap:1 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=ssrc:3527315899 cname:b9a4ca87-1c7b-40a3-9400-a6012c725faa\na=ssrc:3527315899 msid:b9a4ca87-1c7b-40a3-9400-a6012c725faa 5f41be8b-ac56-45f7-a6e1-43230fd3275b\na=ssrc:3527315899 mslabel:b9a4ca87-1c7b-40a3-9400-a6012c725faa\na=ssrc:3527315899 label:5f41be8b-ac56-45f7-a6e1-43230fd3275b\na=msid:b9a4ca87-1c7b-40a3-9400-a6012c725faa 5f41be8b-ac56-45f7-a6e1-43230fd3275b\na=sendrecv\na=candidate:2601828059 1 udp 2130706431 192.168.178.52 63790 typ host\na=candidate:2601828059 2 udp 2130706431 192.168.178.52 63790 typ host\na=end-of-candidates\nm=audio 9 UDP/TLS/RTP/SAVPF 111 9 0 8\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:1\na=ice-ufrag:TdWlIfFKsezBQFZi\na=ice-pwd:BSCDgvfLwdRNSTktphhNdZNrMfjdsTbl\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:111 opus/48000/2\na=fmtp:111 minptime=10;useinbandfec=1\na=rtcp-fb:111 transport-cc \na=rtpmap:9 G722/8000\na=rtcp-fb:9 transport-cc \na=rtpmap:0 PCMU/8000\na=rtcp-fb:0 transport-cc \na=rtpmap:8 PCMA/8000\na=rtcp-fb:8 transport-cc \na=extmap:1 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=ssrc:2599921139 cname:b9a4ca87-1c7b-40a3-9400-a6012c725faa\na=ssrc:2599921139 msid:b9a4ca87-1c7b-40a3-9400-a6012c725faa 8ee73690-957e-4e21-97b8-c91d93b11451\na=ssrc:2599921139 mslabel:b9a4ca87-1c7b-40a3-9400-a6012c725faa\na=ssrc:2599921139 label:8ee73690-957e-4e21-97b8-c91d93b11451\na=msid:b9a4ca87-1c7b-40a3-9400-a6012c725faa 8ee73690-957e-4e21-97b8-c91d93b11451\na=sendrecv\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:2\na=sendrecv\na=sctp-port:5000\na=ice-ufrag:TdWlIfFKsezBQFZi\na=ice-pwd:BSCDgvfLwdRNSTktphhNdZNrMfjdsTbl\n"
const pionOfferWithSecsMedia = "v=0\no=- 1832867179684322390 1705496349 IN IP4 0.0.0.0\ns=-\nt=0 0\na=fingerprint:sha-256 02:E0:BE:4A:D6:B0:A3:9A:5D:15:87:CB:8E:04:70:79:64:44:54:CF:7C:5E:7C:7A:61:88:F7:D5:00:C6:4B:FC\na=extmap-allow-mixed\na=group:BUNDLE 0 1 2 3 4\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:0\na=sendrecv\na=sctp-port:5000\na=ice-ufrag:tfVpltvATopBZwMW\na=ice-pwd:bVZOrDPVIslwFyfdsJVvkqRFFPsxzFxM\na=candidate:2601828059 1 udp 2130706431 192.300.30.1 63046 typ host\na=candidate:2601828059 2 udp 2130706431 192.300.30.1 63046 typ host\na=candidate:2589410501 1 udp 2130706431 192.200.20.1 53113 typ host\na=candidate:2589410501 2 udp 2130706431 192.200.20.1 53113 typ host\na=candidate:2790028924 1 udp 1694498815 192.100.00.2 28495 typ srflx raddr 0.0.0.0 rport 60087\na=candidate:2790028924 2 udp 1694498815 192.100.00.2 28495 typ srflx raddr 0.0.0.0 rport 60087\na=candidate:3687220878 1 udp 2130706431 10.10.10.01 64670 typ host\na=candidate:3687220878 2 udp 2130706431 10.10.10.01 64670 typ host\na=candidate:1584046209 1 udp 2130706431 10.10.10.02 58527 typ host\na=candidate:1584046209 2 udp 2130706431 10.10.10.02 58527 typ host\na=candidate:2913815463 1 udp 2130706431 10.10.10.03 54378 typ host\na=candidate:2913815463 2 udp 2130706431 10.10.10.03 54378 typ host\na=candidate:927886624 1 udp 1694498815 10.10.10.02 54519 typ srflx raddr :: rport 54519\na=candidate:927886624 2 udp 1694498815 10.10.10.02 54519 typ srflx raddr :: rport 54519\na=end-of-candidates\nm=audio 9 UDP/TLS/RTP/SAVPF 111 9 0 8\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:1\na=ice-ufrag:tfVpltvATopBZwMW\na=ice-pwd:bVZOrDPVIslwFyfdsJVvkqRFFPsxzFxM\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:111 opus/48000/2\na=fmtp:111 minptime=10;useinbandfec=1\na=rtcp-fb:111 transport-cc \na=rtpmap:9 G722/8000\na=rtpmap:0 PCMU/8000\na=rtpmap:8 PCMA/8000\na=extmap:1 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=ssrc:90783853 cname:a02a38f9-0978-4d39-ae4c-e42f8671037e\na=ssrc:90783853 msid:a02a38f9-0978-4d39-ae4c-e42f8671037e 1f02c330-c5c6-4607-b584-dfd68bbe90b1\na=ssrc:90783853 mslabel:a02a38f9-0978-4d39-ae4c-e42f8671037e\na=ssrc:90783853 label:1f02c330-c5c6-4607-b584-dfd68bbe90b1\na=msid:a02a38f9-0978-4d39-ae4c-e42f8671037e 1f02c330-c5c6-4607-b584-dfd68bbe90b1\na=sendrecv\nm=audio 9 UDP/TLS/RTP/SAVPF 111 9 0 8\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:2\na=ice-ufrag:tfVpltvATopBZwMW\na=ice-pwd:bVZOrDPVIslwFyfdsJVvkqRFFPsxzFxM\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:111 opus/48000/2\na=fmtp:111 minptime=10;useinbandfec=1\na=rtcp-fb:111 transport-cc \na=rtpmap:9 G722/8000\na=rtpmap:0 PCMU/8000\na=rtpmap:8 PCMA/8000\na=extmap:1 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=ssrc:194162560 cname:915649cc-3d54-44f5-b7c0-ca2e388cc358\na=ssrc:194162560 msid:915649cc-3d54-44f5-b7c0-ca2e388cc358 c8337113-3c48-43c2-9ecd-ce2b2b109154\na=ssrc:194162560 mslabel:915649cc-3d54-44f5-b7c0-ca2e388cc358\na=ssrc:194162560 label:c8337113-3c48-43c2-9ecd-ce2b2b109154\na=msid:915649cc-3d54-44f5-b7c0-ca2e388cc358 c8337113-3c48-43c2-9ecd-ce2b2b109154\na=sendrecv\nm=video 9 UDP/TLS/RTP/SAVPF 96 97 102 103 104 105 106 107 108 109 127 125 39 40 45 46 98 99 100 101 112 113\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:3\na=ice-ufrag:tfVpltvATopBZwMW\na=ice-pwd:bVZOrDPVIslwFyfdsJVvkqRFFPsxzFxM\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:96 VP8/90000\na=rtcp-fb:96 goog-remb \na=rtcp-fb:96 transport-cc \na=rtcp-fb:96 ccm fir\na=rtcp-fb:96 nack \na=rtcp-fb:96 nack pli\na=rtpmap:97 rtx/90000\na=fmtp:97 apt=96\na=rtpmap:102 H264/90000\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\na=rtcp-fb:102 goog-remb \na=rtcp-fb:102 transport-cc \na=rtcp-fb:102 ccm fir\na=rtcp-fb:102 nack \na=rtcp-fb:102 nack pli\na=rtpmap:103 rtx/90000\na=fmtp:103 apt=102\na=rtpmap:104 H264/90000\na=fmtp:104 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\na=rtcp-fb:104 goog-remb \na=rtcp-fb:104 transport-cc \na=rtcp-fb:104 ccm fir\na=rtcp-fb:104 nack \na=rtcp-fb:104 nack pli\na=rtpmap:105 rtx/90000\na=fmtp:105 apt=104\na=rtpmap:106 H264/90000\na=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\na=rtcp-fb:106 goog-remb \na=rtcp-fb:106 transport-cc \na=rtcp-fb:106 ccm fir\na=rtcp-fb:106 nack \na=rtcp-fb:106 nack pli\na=rtpmap:107 rtx/90000\na=fmtp:107 apt=106\na=rtpmap:108 H264/90000\na=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\na=rtcp-fb:108 goog-remb \na=rtcp-fb:108 transport-cc \na=rtcp-fb:108 ccm fir\na=rtcp-fb:108 nack \na=rtcp-fb:108 nack pli\na=rtpmap:109 rtx/90000\na=fmtp:109 apt=108\na=rtpmap:127 H264/90000\na=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\na=rtcp-fb:127 goog-remb \na=rtcp-fb:127 transport-cc \na=rtcp-fb:127 ccm fir\na=rtcp-fb:127 nack \na=rtcp-fb:127 nack pli\na=rtpmap:125 rtx/90000\na=fmtp:125 apt=127\na=rtpmap:39 H264/90000\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\na=rtcp-fb:39 goog-remb \na=rtcp-fb:39 transport-cc \na=rtcp-fb:39 ccm fir\na=rtcp-fb:39 nack \na=rtcp-fb:39 nack pli\na=rtpmap:40 rtx/90000\na=fmtp:40 apt=39\na=rtpmap:45 AV1/90000\na=rtcp-fb:45 goog-remb \na=rtcp-fb:45 transport-cc \na=rtcp-fb:45 ccm fir\na=rtcp-fb:45 nack \na=rtcp-fb:45 nack pli\na=rtpmap:46 rtx/90000\na=fmtp:46 apt=45\na=rtpmap:98 VP9/90000\na=fmtp:98 profile-id=0\na=rtcp-fb:98 goog-remb \na=rtcp-fb:98 transport-cc \na=rtcp-fb:98 ccm fir\na=rtcp-fb:98 nack \na=rtcp-fb:98 nack pli\na=rtpmap:99 rtx/90000\na=fmtp:99 apt=98\na=rtpmap:100 VP9/90000\na=fmtp:100 profile-id=2\na=rtcp-fb:100 goog-remb \na=rtcp-fb:100 transport-cc \na=rtcp-fb:100 ccm fir\na=rtcp-fb:100 nack \na=rtcp-fb:100 nack pli\na=rtpmap:101 rtx/90000\na=fmtp:101 apt=100\na=rtpmap:112 H264/90000\na=fmtp:112 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\na=rtcp-fb:112 goog-remb \na=rtcp-fb:112 transport-cc \na=rtcp-fb:112 ccm fir\na=rtcp-fb:112 nack \na=rtcp-fb:112 nack pli\na=rtpmap:113 rtx/90000\na=fmtp:113 apt=112\na=extmap:1 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=ssrc:2356579599 cname:a02a38f9-0978-4d39-ae4c-e42f8671037e\na=ssrc:2356579599 msid:a02a38f9-0978-4d39-ae4c-e42f8671037e 18a0caea-6b8f-4cb7-ac74-71aaf535a9d4\na=ssrc:2356579599 mslabel:a02a38f9-0978-4d39-ae4c-e42f8671037e\na=ssrc:2356579599 label:18a0caea-6b8f-4cb7-ac74-71aaf535a9d4\na=msid:a02a38f9-0978-4d39-ae4c-e42f8671037e 18a0caea-6b8f-4cb7-ac74-71aaf535a9d4\na=sendrecv\nm=video 9 UDP/TLS/RTP/SAVPF 96 97 102 103 104 105 106 107 108 109 127 125 39 40 45 46 98 99 100 101 112 113\nc=IN IP4 0.0.0.0\na=setup:actpass\na=mid:4\na=ice-ufrag:tfVpltvATopBZwMW\na=ice-pwd:bVZOrDPVIslwFyfdsJVvkqRFFPsxzFxM\na=rtcp-mux\na=rtcp-rsize\na=rtpmap:96 VP8/90000\na=rtcp-fb:96 goog-remb \na=rtcp-fb:96 transport-cc \na=rtcp-fb:96 ccm fir\na=rtcp-fb:96 nack \na=rtcp-fb:96 nack pli\na=rtpmap:97 rtx/90000\na=fmtp:97 apt=96\na=rtpmap:102 H264/90000\na=fmtp:102 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f\na=rtcp-fb:102 goog-remb \na=rtcp-fb:102 transport-cc \na=rtcp-fb:102 ccm fir\na=rtcp-fb:102 nack \na=rtcp-fb:102 nack pli\na=rtpmap:103 rtx/90000\na=fmtp:103 apt=102\na=rtpmap:104 H264/90000\na=fmtp:104 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42001f\na=rtcp-fb:104 goog-remb \na=rtcp-fb:104 transport-cc \na=rtcp-fb:104 ccm fir\na=rtcp-fb:104 nack \na=rtcp-fb:104 nack pli\na=rtpmap:105 rtx/90000\na=fmtp:105 apt=104\na=rtpmap:106 H264/90000\na=fmtp:106 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f\na=rtcp-fb:106 goog-remb \na=rtcp-fb:106 transport-cc \na=rtcp-fb:106 ccm fir\na=rtcp-fb:106 nack \na=rtcp-fb:106 nack pli\na=rtpmap:107 rtx/90000\na=fmtp:107 apt=106\na=rtpmap:108 H264/90000\na=fmtp:108 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=42e01f\na=rtcp-fb:108 goog-remb \na=rtcp-fb:108 transport-cc \na=rtcp-fb:108 ccm fir\na=rtcp-fb:108 nack \na=rtcp-fb:108 nack pli\na=rtpmap:109 rtx/90000\na=fmtp:109 apt=108\na=rtpmap:127 H264/90000\na=fmtp:127 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=4d001f\na=rtcp-fb:127 goog-remb \na=rtcp-fb:127 transport-cc \na=rtcp-fb:127 ccm fir\na=rtcp-fb:127 nack \na=rtcp-fb:127 nack pli\na=rtpmap:125 rtx/90000\na=fmtp:125 apt=127\na=rtpmap:39 H264/90000\na=fmtp:39 level-asymmetry-allowed=1;packetization-mode=0;profile-level-id=4d001f\na=rtcp-fb:39 goog-remb \na=rtcp-fb:39 transport-cc \na=rtcp-fb:39 ccm fir\na=rtcp-fb:39 nack \na=rtcp-fb:39 nack pli\na=rtpmap:40 rtx/90000\na=fmtp:40 apt=39\na=rtpmap:45 AV1/90000\na=rtcp-fb:45 goog-remb \na=rtcp-fb:45 transport-cc \na=rtcp-fb:45 ccm fir\na=rtcp-fb:45 nack \na=rtcp-fb:45 nack pli\na=rtpmap:46 rtx/90000\na=fmtp:46 apt=45\na=rtpmap:98 VP9/90000\na=fmtp:98 profile-id=0\na=rtcp-fb:98 goog-remb \na=rtcp-fb:98 transport-cc \na=rtcp-fb:98 ccm fir\na=rtcp-fb:98 nack \na=rtcp-fb:98 nack pli\na=rtpmap:99 rtx/90000\na=fmtp:99 apt=98\na=rtpmap:100 VP9/90000\na=fmtp:100 profile-id=2\na=rtcp-fb:100 goog-remb \na=rtcp-fb:100 transport-cc \na=rtcp-fb:100 ccm fir\na=rtcp-fb:100 nack \na=rtcp-fb:100 nack pli\na=rtpmap:101 rtx/90000\na=fmtp:101 apt=100\na=rtpmap:112 H264/90000\na=fmtp:112 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=64001f\na=rtcp-fb:112 goog-remb \na=rtcp-fb:112 transport-cc \na=rtcp-fb:112 ccm fir\na=rtcp-fb:112 nack \na=rtcp-fb:112 nack pli\na=rtpmap:113 rtx/90000\na=fmtp:113 apt=112\na=extmap:1 http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01\na=ssrc:820724424 cname:915649cc-3d54-44f5-b7c0-ca2e388cc358\na=ssrc:820724424 msid:915649cc-3d54-44f5-b7c0-ca2e388cc358 abdc694c-b237-4c96-8fcc-d9ad8ba6643f\na=ssrc:820724424 mslabel:915649cc-3d54-44f5-b7c0-ca2e388cc358\na=ssrc:820724424 label:abdc694c-b237-4c96-8fcc-d9ad8ba6643f\na=msid:915649cc-3d54-44f5-b7c0-ca2e388cc358 abdc694c-b237-4c96-8fcc-d9ad8ba6643f\na=sendrecv\n"

func TestSDP(t *testing.T) {
	t.Run("Read empty sdp", func(t *testing.T) {
		repo := newTrackSdpInfoRepository()
		err := getIngressTrackSdpInfo(webrtc.SessionDescription{}, uuid.New(), repo)
		assert.NoError(t, err)
		assert.Equal(t, 0, repo.Len())
	})

	//t.Run("Read not changed offer sdp", func(t *testing.T) {
	//	repo := newTrackSdpInfoRepository()
	//	err := getIngressTrackSdpInfo(webrtc.SessionDescription{
	//		Type: webrtc.SDPTypeOffer,
	//		SDP:  sdpOfferString,
	//	}, uuid.New(), repo)
	//	assert.NoError(t, err)
	//	assert.Equal(t, 2, repo.Len())
	//	audio, hasAudio := repo.getSdpInfoByIngressTrackId("359bc90f-bc4c-47a7-b283-30e88abc2374")
	//	assert.True(t, hasAudio)
	//	assert.Equal(t, PurposeGuest, audio.Purpose)
	//	assert.Equal(t, true, audio.Mute)
	//	assert.Equal(t, "Guest-Audio", audio.Info)
	//	assert.Equal(t, "359bc90f-bc4c-47a7-b283-30e88abc2374", audio.IngressTrackId)
	//	video, hasVideo := repo.getSdpInfoByIngressTrackId("2e86a7ac-b7e9-470f-9c53-6160e468e658")
	//	assert.True(t, hasVideo)
	//	assert.Equal(t, PurposeGuest, video.Purpose)
	//	assert.Equal(t, false, video.Mute)
	//	assert.Equal(t, "Guest-Video", video.Info)
	//	assert.Equal(t, "2e86a7ac-b7e9-470f-9c53-6160e468e658", video.IngressTrackId)
	//})
	//
	//t.Run("Read Firefox not changed offer sdp", func(t *testing.T) {
	//	repo := newTrackSdpInfoRepository()
	//	err := getIngressTrackSdpInfo(webrtc.SessionDescription{
	//		Type: webrtc.SDPTypeOffer,
	//		SDP:  sdpFirefoxOfferString,
	//	}, uuid.New(), repo)
	//	assert.NoError(t, err)
	//	assert.Equal(t, 2, repo.Len())
	//	audio, hasAudio := repo.getSdpInfoByIngressTrackId("{fa595b2c-ba3a-4cd9-93b8-91c20b8af758}")
	//	assert.True(t, hasAudio)
	//	assert.Equal(t, PurposeGuest, audio.Purpose)
	//	assert.Equal(t, true, audio.Mute)
	//	assert.Equal(t, "Guest-Audio", audio.Info)
	//	assert.Equal(t, "{fa595b2c-ba3a-4cd9-93b8-91c20b8af758}", audio.IngressTrackId)
	//	video, hasVideo := repo.getSdpInfoByIngressTrackId("{397dc6f7-76cc-4044-9a12-15cb433b99fc}")
	//	assert.True(t, hasVideo)
	//	assert.Equal(t, PurposeGuest, video.Purpose)
	//	assert.Equal(t, false, video.Mute)
	//	assert.Equal(t, "Guest-Video", video.Info)
	//	assert.Equal(t, "{397dc6f7-76cc-4044-9a12-15cb433b99fc}", video.IngressTrackId)
	//})
	//
	//t.Run("Read live stream from offer sdp", func(t *testing.T) {
	//	repo := newTrackSdpInfoRepository()
	//	err := getIngressTrackSdpInfo(webrtc.SessionDescription{
	//		Type: webrtc.SDPTypeOffer,
	//		SDP:  sdpOfferWithLiveStream,
	//	}, uuid.New(), repo)
	//	assert.NoError(t, err)
	//	assert.Equal(t, 4, repo.Len())
	//	audio, hasAudio := repo.getSdpInfoByIngressTrackId("57e34f3b-e41d-4dd1-94ef-a5db7d13ca53")
	//	assert.True(t, hasAudio)
	//	assert.Equal(t, PurposeGuest, audio.Purpose)
	//	assert.Equal(t, false, audio.Mute)
	//	assert.Equal(t, "Guest-Audio", audio.Info)
	//	assert.Equal(t, "57e34f3b-e41d-4dd1-94ef-a5db7d13ca53", audio.IngressTrackId)
	//	video, hasVideo := repo.getSdpInfoByIngressTrackId("5dacbd5d-f234-4496-923a-c5c188ee9424")
	//	assert.True(t, hasVideo)
	//	assert.Equal(t, PurposeGuest, video.Purpose)
	//	assert.Equal(t, false, video.Mute)
	//	assert.Equal(t, "Guest-Video", video.Info)
	//	assert.Equal(t, "5dacbd5d-f234-4496-923a-c5c188ee9424", video.IngressTrackId)
	//	liveAudio, hasLiveAudio := repo.getSdpInfoByIngressTrackId("a9345edd-5648-4d78-81be-02e0114adbcd")
	//	assert.True(t, hasLiveAudio)
	//	assert.Equal(t, PurposeMain, liveAudio.Purpose)
	//	assert.Equal(t, true, liveAudio.Mute)
	//	assert.Equal(t, "Main-Audio", liveAudio.Info)
	//	assert.Equal(t, "a9345edd-5648-4d78-81be-02e0114adbcd", liveAudio.IngressTrackId)
	//	liveVideo, hasLiveVideo := repo.getSdpInfoByIngressTrackId("a0a03556-3aff-4684-b3ab-59c7bf4cb4bc")
	//	assert.True(t, hasLiveVideo)
	//	assert.Equal(t, PurposeMain, liveVideo.Purpose)
	//	assert.Equal(t, true, liveVideo.Mute)
	//	assert.Equal(t, "Main-Video", liveVideo.Info)
	//	assert.Equal(t, "a0a03556-3aff-4684-b3ab-59c7bf4cb4bc", liveVideo.IngressTrackId)
	//})
	//
	//t.Run("set stream as main stream", func(t *testing.T) {
	//	streamID := "b9a4ca87-1c7b-40a3-9400-a6012c725faa"
	//	offer := &webrtc.SessionDescription{
	//		Type: webrtc.SDPTypeOffer,
	//		SDP:  pionSdpOfferWithoutLiveStream,
	//	}
	//	newOffer, err := MarkStreamAsMain(offer, streamID)
	//
	//	cupaloy.SnapshotT(t, newOffer.SDP)
	//	assert.NoError(t, err)
	//})
	//
	//t.Run("munge offer with track info list", func(t *testing.T) {
	//	repo := testTrackInfoRepositorySetup(t)
	//	offer := &webrtc.SessionDescription{
	//		Type: webrtc.SDPTypeOffer,
	//		SDP:  pionOfferWithSecsMedia,
	//	}
	//	newOffer, err := setEgressTrackInfo(offer, repo)
	//	assert.NoError(t, err)
	//	cupaloy.SnapshotT(t, newOffer.SDP)
	//})
}

func testTrackInfoRepositorySetup(t *testing.T) *trackSdpInfoRepository {
	t.Helper()
	repo := newTrackSdpInfoRepository()
	session := uuid.UUID{}
	// mid: 1, sudio msid:a02a38f9-0978-4d39-ae4c-e42f8671037e 1f02c330-c5c6-4607-b584-dfd68bbe90b1
	t1 := uuid.New()
	repo.Set(t1, &TrackSdpInfo{Id: t1, SessionId: session, Purpose: PurposeGuest, Mute: false, Info: "Audio-Guest", EgressTrackId: "1f02c330-c5c6-4607-b584-dfd68bbe90b1"})
	// mid: 2, audio msid:915649cc-3d54-44f5-b7c0-ca2e388cc358 c8337113-3c48-43c2-9ecd-ce2b2b109154
	t2 := uuid.New()
	repo.Set(t2, &TrackSdpInfo{Id: t2, SessionId: session, Purpose: PurposeMain, Mute: true, Info: "Audio-Main", EgressTrackId: "c8337113-3c48-43c2-9ecd-ce2b2b109154"})
	// mid: 3, video msid:a02a38f9-0978-4d39-ae4c-e42f8671037e 18a0caea-6b8f-4cb7-ac74-71aaf535a9d4
	t3 := uuid.New()
	repo.Set(t3, &TrackSdpInfo{Id: t3, SessionId: session, Purpose: PurposeGuest, Mute: false, Info: "Guest-Video", EgressTrackId: "18a0caea-6b8f-4cb7-ac74-71aaf535a9d4"})
	// mid: 4, video msid:915649cc-3d54-44f5-b7c0-ca2e388cc358 abdc694c-b237-4c96-8fcc-d9ad8ba6643f
	t4 := uuid.New()
	repo.Set(t4, &TrackSdpInfo{Id: t4, SessionId: session, Purpose: PurposeMain, Mute: true, Info: "Main-Video", EgressTrackId: "abdc694c-b237-4c96-8fcc-d9ad8ba6643f"})
	return repo
}
